<!DOCTYPE html>
<html>
<head>
    <title>Мои заметки</title>
    <link rel="stylesheet" href="<%= baseUrl %>/fonts.css">
    <style>
        :root { --bg-body: #E5E5E5; --card-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        body { margin: 0; padding: 0; background-color: var(--bg-body); display: flex; font-family: 'Manrope', sans-serif; }
        .main-content { flex: 1; margin-left: 260px; padding: 40px; }
        .page-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        .table-container { background: white; border-radius: 15px; overflow: hidden; box-shadow: var(--card-shadow); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; color: #666; font-weight: 500; font-size: 13px; text-align: center; padding: 15px; }
        td { padding: 20px; border-bottom: 1px solid #f0f0f0; font-size: 14px; text-align: center; vertical-align: top; }
        .note-text { text-align: left; max-width: 400px; line-height: 1.5; }
        .tag { font-size: 12px; font-weight: 700; color: #666; }
        .status { font-weight: 700; }
        .status.отработано { color: #27ae60; }
        .status.неотработано { color: #e74c3c; }
        .status.нераспознано { color: #95a5a6; }
    </style>
</head>
<body>
    <%- include('sidebar') %>
    <div class="main-content">
        <div class="page-header">
            <h2 style="margin: 0;">Заметки</h2>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 100px;">Дата диалога</th>
                        <th style="width: 150px;">Активность</th>
                        <th style="width: 100px;">Дата заметки</th>
                        <th style="width: 120px;">Статус диалога</th>
                        <% if (user.role === 'superadmin') { %><th style="width: 100px;">Автор</th><% } %>
                        <th>Заметка</th>
                    </tr>
                </thead>
                <tbody>
                    <% notes.forEach(n => { %>
                    <tr style="cursor:pointer" onclick="window.location.href='<%= baseUrl %>/details/<%= n.Call.id %>'">
                        <td><strong><%= moment(n.Call.date).format('DD.MM.YY') %></strong></td>
                        <td>
                            <% if (n.Call.rudeness > 0.5) { %><div class="tag">#грубая ошибка</div><% } %>
                            <% if (n.Call.said_hello === false) { %><div class="tag">#отсутствие приветствия</div><% } %>
                        </td>
                        <td><%= moment(n.updatedAt).format('DD.MM.YY') %></td>
                        <td class="status <%= n.Call.status ? n.Call.status.replace(' ', '') : '' %>">
                            <%= n.Call.status || 'без статуса' %>
                        </td>
                        <% if (user.role === 'superadmin') { %><td><%= n.User.fullName %></td><% } %>
                        <td class="note-text"><%= n.content %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>